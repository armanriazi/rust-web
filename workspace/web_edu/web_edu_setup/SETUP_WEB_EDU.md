# Setup

---

1. First install diesel_cli_ext:

```
cargo install diesel_cli_ext
```

2. You would have to generate your schema file the diesel way if you haven't yet:

```
diesel print-schema > ../web_edu_lib/src/schema.rs --database-url='./db/web_edu.sqlite'
diesel print-schema > ../web_edu_lib/src/schema.rs --database-url='./db/web_edu_test.sqlite'
```

3. generate the models file(optional in this step):

```
diesel_ext --model > workspace/web_edu/web_edu_lib/src/model.rs
```

4. setup

```
diesel setup --database-url='./db/web_edu.sqlite'
diesel setup --database-url='./db/web_edu_test.sqlite'
```

5. create migrations folder

```
mkdir ./migrations
```

6. generate and fill out up, down.sql

```
diesel migration generate create_products --migration-dir='./migrations'
diesel migration generate create_variants --migration-dir='./migrations'
diesel migration generate create_sales --migration-dir='./migrations'
```

7. migration

```
diesel migration run --database-url='./db/web_edu.sqlite' --migration-dir='./migrations/2023-02-14-103809_create_products'
diesel migration run --database-url='./db/web_edu_test.sqlite' --migration-dir='./migrations/2023-02-14-103809_create_products'
```
>

```
diesel migration run --database-url='./db/web_edu.sqlite' --migration-dir='./migrations/2023-02-14-104325_create_variants'
diesel migration run --database-url='./db/web_edu_test.sqlite' --migration-dir='./migrations/2023-02-14-104325_create_variants'
```
>

```
diesel migration run --database-url='./db/web_edu.sqlite' --migration-dir='./migrations/2023-02-23-173809_create_sales'
diesel migration run --database-url='./db/web_edu_test.sqlite' --migration-dir='./migrations/2023-02-23-173809_create_sales'
```

8. return to step 2 for cheking it is nessecarry to check schema file, is it generated by step 7 or not?

2. check created tables in db

```
sqlite3 ./db/web_edu.sqlite
sqlite3 ./db/web_edu_test.sqlite

```
```
.tables
```

---
diesel migration revert
diesel migration redo
---
[print_schema]
import_types = [ "crate::schema::*" ]
import_types = ["diesel::sql_types::*", "diesel_full_text_search::types::*"]
filter = { only_tables = ["products"] }
----


> setup_db.sh
```
#!/usr/bin/env bash
cd $(dirname "$0")
sqlite3 ../weather.db < db.sql
sqlite3 -csv ../weather.db ".import nyc_centralpark_weather.csv nyc_weather"
```